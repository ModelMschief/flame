<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>BG Video Test (JS autoplay + fallback)</title>
  <style>
    html,body{margin:0;height:100%;background:#000;overflow:hidden;font-family:system-ui,Arial}
    /* video full-bleed */
    #bg {
      position:fixed; inset:0; width:100%; height:100%;
      object-fit:cover; z-index:-1; background:#000;
    }
    /* centered content */
    .content {
      position:relative; z-index:1; height:100%;
      display:flex; align-items:center; justify-content:center; color:#fff; text-align:center;
      text-shadow:0 2px 10px rgba(0,0,0,.8);
    }
    /* play button shown if autoplay fails */
    #playBtn {
      position:fixed; inset:auto 0 6vh 0; margin:auto; width:max-content;
      background:rgba(0,0,0,.55); color:#fff; border:1px solid rgba(255,255,255,.25);
      padding:.8rem 1.2rem; border-radius:10px; cursor:pointer; display:none; z-index:2;
      backdrop-filter:saturate(120%) blur(6px);
    }
    /* tiny diagnostics */
    #diag {
      position:fixed; left:10px; bottom:10px; color:#9fd4ff; font:12px/1.3 monospace; z-index:3;
      background:rgba(0,0,0,.6); padding:.5rem .6rem; border-radius:8px; display:none; white-space:pre-wrap;
      border:1px solid rgba(159,212,255,.25);
    }
  </style>
</head>
<body>

  <!-- Video in SAME folder: ./flame.mp4 -->
  <video id="bg" playsinline muted loop preload="auto" poster="">
    <source src="flame.mp4" type="video/mp4">
    Your browser does not support HTML5 video.
  </video>

  <button id="playBtn" type="button">▶️ Play Background</button>
  <div class="content">
    <div>
      <h1>Blue Flame Background</h1>
      <p>If you see only black, check the diagnostics box (bottom-left).</p>
    </div>
  </div>
  <div id="diag"></div>

  <script>
    (async () => {
      const v = document.getElementById('bg');
      const btn = document.getElementById('playBtn');
      const diag = document.getElementById('diag');

      const log = (m) => { diag.style.display='block'; diag.textContent += (diag.textContent?'\n':'') + m; };

      // 1) quick codec sanity check
      const canH264 = v.canPlayType('video/mp4; codecs="avc1.42E01E, mp4a.40.2"');
      if (!canH264) log('Browser says H.264/AAC may not be supported.');
      
      // 2) HEAD request to ensure the file is actually reachable (case/path!)
      try {
        const res = await fetch('./flame.mp4', { method:'HEAD', cache:'no-store' });
        if (!res.ok) log(`HEAD ./flame.mp4 → HTTP ${res.status}. Check filename/case and folder.`);
      } catch (e) {
        log('HEAD ./flame.mp4 failed. Likely path or CORS issue.');
      }

      // 3) force muted + try autoplay via JS
      v.muted = true;
      try {
        await v.play();
        // success
      } catch (err) {
        // Autoplay blocked → show button
        btn.style.display = 'block';
        log('Autoplay was blocked. Click the button to start playback.');
      }

      // 4) click-to-play fallback
      btn.addEventListener('click', async () => {
        btn.disabled = true;
        try {
          await v.play();
          btn.style.display = 'none';
        } catch (e) {
          log('Manual play failed: ' + (e && e.message ? e.message : e));
          btn.disabled = false;
        }
      });

      // 5) visibility handling (optional)
      document.addEventListener('visibilitychange', () => {
        if (document.hidden) { v.pause(); }
        else { v.play().catch(()=>{}); }
      });
    })();
  </script>
</body>
</html>
